<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DailyDose - Your Daily Inspiration</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’Š</text></svg>"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700&display=swap"
      rel="stylesheet"
    />
    <style>
      body,
      .font-sans {
        font-family: "Open Sans", Arial, Helvetica, sans-serif !important;
      }

      /* Dark mode styles */
      body.dark {
        background-color: #1a1a1a;
        color: #ffffff;
      }

      body.dark nav {
        background-color: #2d2d2d;
        border-bottom: 1px solid #404040;
      }

      body.dark .bg-white {
        background-color: #2d2d2d;
      }

      body.dark .text-gray-800 {
        color: #ffffff;
      }

      body.dark .text-gray-700 {
        color: #e5e5e5;
      }

      body.dark .text-gray-600 {
        color: #d1d5db;
      }

      body.dark .text-gray-500 {
        color: #9ca3af;
      }

      body.dark .border-gray-300 {
        border-color: #404040;
      }

      body.dark .bg-gray-100 {
        background-color: #404040;
      }

      body.dark .bg-gray-200 {
        background-color: #525252;
      }

      body.dark .text-gray-400 {
        color: #9ca3af;
      }

      body.dark input::placeholder,
      body.dark textarea::placeholder {
        color: #9ca3af !important;
      }

      body.dark input,
      body.dark textarea {
        background-color: #2d2d2d;
        color: #ffffff;
        border-color: #404040;
      }

      body.dark input:focus,
      body.dark textarea:focus {
        background-color: #2d2d2d;
        color: #ffffff;
        border-color: #8b5cf6;
      }

      body.dark .shadow-lg {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
      }

      body.dark .quote-card {
        background: rgba(45, 45, 45, 0.95);
        border: 1px solid #404040;
      }

      body.dark .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.7);
      }

      body.dark .bg-white.rounded-2xl {
        background-color: #2d2d2d;
        border: 1px solid #404040;
      }

      body.dark .bg-white.rounded-xl {
        background-color: #2d2d2d;
        border: 1px solid #404040;
      }

      body.dark .text-gray-900 {
        color: #ffffff !important;
      }

      /* Dark mode form input styles */
      body.dark input::placeholder,
      body.dark textarea::placeholder,
      body.dark select::placeholder {
        color: #9ca3af !important;
      }

      body.dark input,
      body.dark textarea,
      body.dark select {
        background-color: #2d2d2d !important;
        color: #ffffff !important;
        border-color: #404040 !important;
      }

      body.dark input:focus,
      body.dark textarea:focus,
      body.dark select:focus {
        background-color: #2d2d2d !important;
        color: #ffffff !important;
        border-color: #8b5cf6 !important;
        outline: none !important;
      }

      body.dark select option {
        background-color: #2d2d2d !important;
        color: #ffffff !important;
      }

      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      body.dark .gradient-bg {
        background: linear-gradient(135deg, #4c1d95 0%, #581c87 100%);
      }

      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      body.dark .card-hover:hover {
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      }

      .quote-card {
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }

      .modal-backdrop {
        -webkit-backdrop-filter: blur(5px);
        backdrop-filter: blur(5px);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .slide-in {
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen font-sans pt-16">
    <!-- Navigation -->
    <nav
      id="navbar"
      class="bg-white/95 backdrop-blur-lg border-b border-gray-100/50 fixed top-0 left-0 right-0 z-50 transition-transform duration-300"
    >
      <div class="max-w-6xl mx-auto px-6">
        <div class="flex justify-between items-center h-16">
          <!-- Logo -->
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <h1
                class="text-2xl font-bold bg-gradient-to-r from-purple-600 via-blue-500 to-purple-600 bg-clip-text text-transparent tracking-tight"
              >
                DailyDose
              </h1>
            </div>
          </div>
          <!-- Navigation Actions -->
          <div class="flex items-center gap-3">
            <button
              id="addQuoteBtn"
              class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-5 py-2.5 rounded-full hover:from-purple-700 hover:to-blue-700 transition-all duration-300 flex items-center gap-2 shadow-sm hover:shadow-md transform hover:-translate-y-0.5 text-sm font-medium"
            >
              <i class="fas fa-plus text-xs"></i>
              <span>Add Quote</span>
            </button>
            <button
              id="darkModeToggle"
              class="p-2.5 rounded-full bg-gray-50/80 hover:bg-gray-100 transition-all duration-300 border border-gray-200/50 hover:border-gray-300"
              title="Toggle dark mode"
            >
              <i class="fas fa-moon text-gray-600 text-base"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="gradient-bg text-white py-16 font-sans">
      <div
        class="max-w-4xl mx-auto px-6 text-center flex flex-col items-center gap-8"
      >
        <h2 class="text-4xl md:text-6xl font-bold mb-4">
          Your Daily Dose of
          <span class="block text-yellow-300">Inspiration</span>
        </h2>
        <p class="text-xl md:text-2xl mb-8 text-gray-100 max-w-3xl mx-auto">
          Discover motivational quotes that uplift your spirit and fuel your
          journey to success
        </p>
        <!-- Quote of the Day -->
        <div
          class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-8 max-w-3xl w-full mx-auto mb-4 flex flex-col items-center"
        >
          <div class="text-sm text-yellow-300 font-semibold mb-2">
            âœ¨ QUOTE OF THE DAY
          </div>
          <div
            class="text-2xl md:text-3xl font-light mb-4 leading-relaxed"
            id="quoteOfTheDay"
          >
            Loading...
          </div>
          <div class="text-lg text-gray-200" id="quoteOfTheDayAuthor">
            - Author
          </div>
          <div class="flex justify-center space-x-4 mt-6">
            <button
              id="refreshDailyQuote"
              class="text-white hover:text-yellow-300 transition-colors"
            >
              <i class="fas fa-sync-alt mr-2"></i>New Daily Quote
            </button>
            <button
              id="addToFavorites"
              class="text-white hover:text-yellow-300 transition-colors"
            >
              <i class="fas fa-heart mr-2"></i>Add to Favorites
            </button>
          </div>
        </div>
        <div
          class="flex flex-col sm:flex-row gap-3 justify-center items-center w-full mt-2"
        >
          <button
            id="exploreBtn"
            class="bg-white text-purple-600 px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-all duration-300 w-full sm:w-auto"
          >
            Explore Quotes
          </button>
          <button
            id="randomQuoteBtn"
            class="border border-white text-white px-8 py-3 rounded-full font-medium hover:bg-white hover:text-purple-600 transition-all duration-300 w-full sm:w-auto"
          >
            Random Quote
          </button>
          <button
            id="loadMoreBtn"
            class="border border-white text-white px-8 py-3 rounded-full font-medium hover:bg-white hover:text-purple-600 transition-all duration-300 w-full sm:w-auto"
          >
            Load More Quotes
          </button>
          <button
            id="favoritesBtn"
            class="border border-white text-white px-8 py-3 rounded-full font-medium hover:bg-white hover:text-purple-600 transition-all duration-300 w-full sm:w-auto"
          >
            <i class="fas fa-heart mr-2"></i>My Favorites
          </button>
        </div>
      </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="bg-white py-8 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="flex flex-col md:flex-row gap-4 items-center justify-between"
        >
          <div class="relative flex-1 max-w-md">
            <input
              type="text"
              id="searchInput"
              placeholder="Search quotes..."
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            />
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
          <div class="flex flex-wrap gap-2">
            <button
              class="filter-btn active px-4 py-2 rounded-lg bg-purple-600 text-white font-medium"
              data-category="all"
            >
              All
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium hover:bg-gray-200"
              data-category="motivation"
            >
              Motivation
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium hover:bg-gray-200"
              data-category="success"
            >
              Success
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium hover:bg-gray-200"
              data-category="wisdom"
            >
              Wisdom
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium hover:bg-gray-200"
              data-category="life"
            >
              Life
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Quotes Grid -->
    <section id="quotesSection" class="py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
          id="quotesGrid"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Quotes will be dynamically loaded here -->
        </div>
      </div>
    </section>

    <!-- Add Quote Modal -->
    <div
      id="addQuoteModal"
      class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 slide-in"
        >
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-900">Add Your Quote</h3>
            <button
              id="closeModal"
              class="text-gray-400 hover:text-gray-600"
              title="Close modal"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <form id="addQuoteForm" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Quote Text</label
              >
              <textarea
                id="quoteText"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Enter your inspirational quote..."
              ></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Author</label
              >
              <input
                type="text"
                id="quoteAuthor"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Quote author"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Category</label
              >
              <select
                id="quoteCategory"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                title="Select quote category"
              >
                <option value="motivation">Motivation</option>
                <option value="success">Success</option>
                <option value="wisdom">Wisdom</option>
                <option value="life">Life</option>
              </select>
            </div>
            <div class="flex gap-3 pt-4">
              <button
                type="submit"
                class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all"
              >
                Add Quote
              </button>
              <button
                type="button"
                id="cancelAdd"
                class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Quote Detail Modal -->
    <div
      id="quoteDetailModal"
      class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 slide-in"
        >
          <div class="text-center">
            <div class="text-6xl text-purple-600 mb-4">
              <i class="fas fa-quote-left"></i>
            </div>
            <p
              id="modalQuoteText"
              class="text-xl text-gray-800 mb-6 leading-relaxed"
            ></p>
            <p
              id="modalQuoteAuthor"
              class="text-lg font-semibold text-purple-600 mb-6"
            ></p>
            <div class="flex justify-center space-x-4">
              <button
                id="copyQuote"
                class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"
              >
                <i class="fas fa-copy mr-2"></i>Copy
              </button>
              <button
                id="shareQuote"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
              >
                <i class="fas fa-share mr-2"></i>Share
              </button>
              <button
                id="closeDetailModal"
                class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors"
                title="Close quote detail"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favorites Modal -->
    <div
      id="favoritesModal"
      class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-6 slide-in"
        >
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-900">
              <i class="fas fa-heart text-red-500 mr-2"></i>My Favorite Quotes
            </h3>
            <button
              id="closeFavoritesModal"
              class="text-gray-400 hover:text-gray-600"
              title="Close favorites"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <div id="favoritesList" class="space-y-4 max-h-96 overflow-y-auto">
            <!-- Favorites will be loaded here -->
          </div>
          <div class="flex justify-end mt-6">
            <button
              id="clearAllFavorites"
              class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors"
            >
              <i class="fas fa-trash mr-2"></i>Clear All Favorites
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Toast -->
    <div
      id="successToast"
      class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50"
    >
      <div class="flex items-center space-x-2">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Quote added successfully!</span>
      </div>
    </div>

    <script>
      // Navbar scroll hide functionality
      let lastScrollTop = 0;
      const navbar = document.getElementById("navbar");

      window.addEventListener("scroll", () => {
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > lastScrollTop && scrollTop > 100) {
          // Scrolling down - hide navbar
          navbar.style.transform = "translateY(-100%)";
        } else {
          // Scrolling up - show navbar
          navbar.style.transform = "translateY(0)";
        }

        lastScrollTop = scrollTop;
      });

      // Sample quotes data (fallback)
      const defaultQuotes = [
        {
          id: 1,
          text: "The only way to do great work is to love what you do.",
          author: "Steve Jobs",
          category: "motivation",
        },
        {
          id: 2,
          text: "Success is not final, failure is not fatal: it is the courage to continue that counts.",
          author: "Winston Churchill",
          category: "success",
        },
        {
          id: 3,
          text: "The future belongs to those who believe in the beauty of their dreams.",
          author: "Eleanor Roosevelt",
          category: "motivation",
        },
        {
          id: 4,
          text: "Life is what happens when you're busy making other plans.",
          author: "John Lennon",
          category: "life",
        },
        {
          id: 5,
          text: "The only limit to our realization of tomorrow is our doubts of today.",
          author: "Franklin D. Roosevelt",
          category: "wisdom",
        },
      ];

      // Fetch quotes from API
      async function fetchQuotesFromAPI() {
        try {
          // Try multiple API calls to get different quotes
          const promises = [];
          for (let i = 0; i < 5; i++) {
            promises.push(
              fetch(
                "https://api.quotable.io/random?tags=inspirational|motivational|success|wisdom|life"
              )
                .then((response) => response.json())
                .catch(() => null)
            );
          }

          const results = await Promise.all(promises);
          const validQuotes = results.filter((quote) => quote && quote.content);

          if (validQuotes.length > 0) {
            return validQuotes.map((quote, index) => ({
              id: Date.now() + index,
              text: quote.content,
              author: quote.author || "Unknown",
              category: getCategoryFromTags(quote.tags || []),
            }));
          }
        } catch (error) {
          console.log("API fetch failed:", error);
        }

        // Fallback: return some additional default quotes
        return [
          {
            id: Date.now() + 1,
            text: "The journey of a thousand miles begins with one step.",
            author: "Lao Tzu",
            category: "motivation",
          },
          {
            id: Date.now() + 2,
            text: "Believe you can and you're halfway there.",
            author: "Theodore Roosevelt",
            category: "motivation",
          },
          {
            id: Date.now() + 3,
            text: "It does not matter how slowly you go as long as you do not stop.",
            author: "Confucius",
            category: "success",
          },
          {
            id: Date.now() + 4,
            text: "The only impossible journey is the one you never begin.",
            author: "Tony Robbins",
            category: "motivation",
          },
          {
            id: Date.now() + 5,
            text: "Success is walking from failure to failure with no loss of enthusiasm.",
            author: "Winston Churchill",
            category: "success",
          },
        ];
      }

      // Map API tags to our categories
      function getCategoryFromTags(tags) {
        if (!tags || tags.length === 0) return "wisdom";

        const tagString = tags.join(" ").toLowerCase();

        if (
          tagString.includes("motivational") ||
          tagString.includes("motivation")
        ) {
          return "motivation";
        } else if (
          tagString.includes("success") ||
          tagString.includes("achievement")
        ) {
          return "success";
        } else if (
          tagString.includes("life") ||
          tagString.includes("philosophy")
        ) {
          return "life";
        } else {
          return "wisdom";
        }
      }

      // Load quotes from localStorage, API, or use default quotes
      async function loadQuotes() {
        const savedQuotes = localStorage.getItem("dailydose-quotes");
        if (savedQuotes) {
          return JSON.parse(savedQuotes);
        }

        // Try to fetch from API first
        const apiQuotes = await fetchQuotesFromAPI();
        if (apiQuotes && apiQuotes.length > 0) {
          return apiQuotes;
        }

        // Fallback to default quotes
        return defaultQuotes;
      }

      // Save quotes to localStorage
      function saveQuotes(quotesArray) {
        localStorage.setItem("dailydose-quotes", JSON.stringify(quotesArray));
      }

      // Favorites functionality
      function getFavorites() {
        const favorites = localStorage.getItem("dailydose-favorites");
        return favorites ? JSON.parse(favorites) : [];
      }

      function saveFavorites(favoritesArray) {
        localStorage.setItem(
          "dailydose-favorites",
          JSON.stringify(favoritesArray)
        );
      }

      function isQuoteFavorite(quoteId) {
        const favorites = getFavorites();
        return favorites.includes(quoteId);
      }

      function toggleFavorite(quoteId) {
        const favorites = getFavorites();
        const index = favorites.indexOf(quoteId);

        if (index > -1) {
          favorites.splice(index, 1);
          showToast("Removed from favorites", "success");
        } else {
          favorites.push(quoteId);
          showToast("Added to favorites", "success");
        }

        saveFavorites(favorites);
        renderQuotes(); // Re-render to update heart icons
      }

      function renderFavorites() {
        console.log("Rendering favorites...");
        const favorites = getFavorites();
        console.log("Favorites:", favorites);
        const favoritesList = document.getElementById("favoritesList");

        if (!favoritesList) {
          console.error("Favorites list element not found!");
          return;
        }

        if (favorites.length === 0) {
          favoritesList.innerHTML = `
             <div class="text-center text-gray-500 py-8">
               <i class="fas fa-heart text-4xl mb-4 text-gray-300"></i>
               <p>No favorite quotes yet.</p>
               <p class="text-sm">Start adding quotes to your favorites!</p>
             </div>
           `;
          return;
        }

        favoritesList.innerHTML = favorites
          .map((quoteId) => {
            const quote = quotes.find((q) => q.id === quoteId);
            if (!quote) return "";

            return `
             <div class="bg-gray-50 rounded-lg p-4 border-l-4 border-red-500">
               <div class="flex justify-between items-start">
                 <div class="flex-1">
                   <p class="text-gray-800 mb-2">"${quote.text}"</p>
                   <div class="flex items-center justify-between">
                     <span class="text-sm font-medium text-purple-600">â€” ${quote.author}</span>
                     <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium capitalize">
                       ${quote.category}
                     </span>
                   </div>
                 </div>
                 <button onclick="toggleFavorite(${quote.id})" class="text-red-500 hover:text-red-700 ml-4">
                   <i class="fas fa-heart"></i>
                 </button>
               </div>
             </div>
           `;
          })
          .join("");
      }

      // Initialize quotes
      let quotes = [];

      // Quote of the Day functionality
      let currentDailyQuote = null;

      async function loadQuoteOfTheDay() {
        const today = new Date().toDateString();
        const savedDailyQuote = localStorage.getItem("dailydose-daily-quote");

        if (savedDailyQuote) {
          const parsed = JSON.parse(savedDailyQuote);
          if (parsed.date === today) {
            currentDailyQuote = parsed.quote;
            displayQuoteOfTheDay();
            return;
          }
        }

        // Fetch new daily quote
        try {
          const response = await fetch(
            "https://api.quotable.io/random?tags=inspirational|motivational"
          );
          const data = await response.json();

          if (data && data.content) {
            currentDailyQuote = {
              id: Date.now(),
              text: data.content,
              author: data.author || "Unknown",
              category: getCategoryFromTags(data.tags || []),
            };
          } else {
            throw new Error("Invalid API response");
          }

          localStorage.setItem(
            "dailydose-daily-quote",
            JSON.stringify({
              date: today,
              quote: currentDailyQuote,
            })
          );

          displayQuoteOfTheDay();
        } catch (error) {
          // Fallback to random quote from our collection
          const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
          currentDailyQuote = randomQuote;
          displayQuoteOfTheDay();
        }
      }

      function displayQuoteOfTheDay() {
        if (!currentDailyQuote) return;

        quoteOfTheDay.textContent = currentDailyQuote.text;
        quoteOfTheDayAuthor.textContent = `â€” ${currentDailyQuote.author}`;
      }

      // Initialize quotes asynchronously
      async function initializeQuotes() {
        quotes = await loadQuotes();
        currentQuotes = [...quotes];
        renderQuotes();
        await loadQuoteOfTheDay();
      }

      let currentQuotes = [...quotes];
      let currentFilter = "all";

      // DOM Elements
      const quotesGrid = document.getElementById("quotesGrid");
      const searchInput = document.getElementById("searchInput");
      const filterBtns = document.querySelectorAll(".filter-btn");
      const addQuoteBtn = document.getElementById("addQuoteBtn");
      const addQuoteModal = document.getElementById("addQuoteModal");
      const closeModal = document.getElementById("closeModal");
      const cancelAdd = document.getElementById("cancelAdd");
      const addQuoteForm = document.getElementById("addQuoteForm");
      const quoteDetailModal = document.getElementById("quoteDetailModal");
      const closeDetailModal = document.getElementById("closeDetailModal");
      const successToast = document.getElementById("successToast");
      const exploreBtn = document.getElementById("exploreBtn");
      const randomQuoteBtn = document.getElementById("randomQuoteBtn");
      const loadMoreBtn = document.getElementById("loadMoreBtn");
      const favoritesBtn = document.getElementById("favoritesBtn");
      const favoritesModal = document.getElementById("favoritesModal");
      const closeFavoritesModal = document.getElementById(
        "closeFavoritesModal"
      );
      const clearAllFavorites = document.getElementById("clearAllFavorites");
      const quoteOfTheDay = document.getElementById("quoteOfTheDay");
      const quoteOfTheDayAuthor = document.getElementById(
        "quoteOfTheDayAuthor"
      );
      const refreshDailyQuote = document.getElementById("refreshDailyQuote");
      const addToFavorites = document.getElementById("addToFavorites");
      const copyQuoteBtn = document.getElementById("copyQuote");
      const shareQuoteBtn = document.getElementById("shareQuote");

      // Initialize the app
      async function init() {
        await initializeQuotes();
        setupEventListeners();
      }

      // Render quotes
      function renderQuotes() {
        quotesGrid.innerHTML = "";
        currentQuotes.forEach((quote) => {
          const quoteCard = createQuoteCard(quote);
          quotesGrid.appendChild(quoteCard);
        });
      }

      // Create quote card
      function createQuoteCard(quote) {
        const card = document.createElement("div");
        card.className =
          "quote-card card-hover rounded-xl p-6 shadow-lg fade-in";
        const isFavorite = isQuoteFavorite(quote.id);
        card.innerHTML = `
           <div class="text-2xl text-purple-600 mb-4">
             <i class="fas fa-quote-left"></i>
           </div>
           <p class="text-gray-800 text-lg mb-4 leading-relaxed">${
             quote.text
           }</p>
           <div class="flex items-center justify-between">
             <span class="text-sm font-medium text-purple-600">â€” ${
               quote.author
             }</span>
             <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium capitalize">
               ${quote.category}
             </span>
           </div>
           <div class="flex justify-end space-x-2 mt-4">
             <button class="copy-btn text-gray-400 hover:text-purple-600 transition-colors" title="Copy quote">
               <i class="fas fa-copy"></i>
             </button>
             <button class="share-btn text-gray-400 hover:text-purple-600 transition-colors" title="Share quote">
               <i class="fas fa-share"></i>
             </button>
             <button class="favorite-btn text-gray-400 hover:text-red-500 transition-colors" title="${
               isFavorite ? "Remove from favorites" : "Add to favorites"
             }">
               <i class="fas fa-heart ${isFavorite ? "text-red-500" : ""}"></i>
             </button>
             <button class="delete-btn text-gray-400 hover:text-red-600 transition-colors" title="Delete quote">
               <i class="fas fa-trash"></i>
             </button>
           </div>
         `;

        // Add event listeners to the buttons
        const copyBtn = card.querySelector(".copy-btn");
        const shareBtn = card.querySelector(".share-btn");
        const favoriteBtn = card.querySelector(".favorite-btn");
        const deleteBtn = card.querySelector(".delete-btn");

        copyBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          copyQuote(`${quote.text} - ${quote.author}`);
        });

        shareBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          shareQuote(`${quote.text} - ${quote.author}`);
        });

        favoriteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleFavorite(quote.id);
        });

        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteQuote(quote.id);
        });

        card.addEventListener("click", (e) => {
          if (!e.target.closest("button")) {
            showQuoteDetail(quote);
          }
        });

        return card;
      }

      // Setup event listeners
      function setupEventListeners() {
        // Search functionality
        searchInput.addEventListener("input", (e) => {
          const searchTerm = e.target.value.toLowerCase();
          filterQuotes(searchTerm, currentFilter);
        });

        // Filter buttons
        filterBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            const category = btn.dataset.category;
            currentFilter = category;

            // Update active button
            filterBtns.forEach((b) => {
              b.classList.remove("active", "bg-purple-600", "text-white");
              b.classList.add("bg-gray-100", "text-gray-700");
            });
            btn.classList.add("active", "bg-purple-600", "text-white");
            btn.classList.remove("bg-gray-100", "text-gray-700");

            filterQuotes(searchInput.value.toLowerCase(), category);
          });
        });

        // Modal controls
        addQuoteBtn.addEventListener("click", () => {
          addQuoteModal.classList.remove("hidden");
        });

        [closeModal, cancelAdd].forEach((btn) => {
          btn.addEventListener("click", () => {
            addQuoteModal.classList.add("hidden");
            addQuoteForm.reset();
          });
        });

        closeDetailModal.addEventListener("click", () => {
          quoteDetailModal.classList.add("hidden");
        });

        // Quote detail modal buttons
        copyQuoteBtn.addEventListener("click", () => {
          const quoteText =
            document.getElementById("modalQuoteText").textContent;
          const quoteAuthor =
            document.getElementById("modalQuoteAuthor").textContent;
          copyQuote(`${quoteText} ${quoteAuthor}`);
        });

        shareQuoteBtn.addEventListener("click", () => {
          const quoteText =
            document.getElementById("modalQuoteText").textContent;
          const quoteAuthor =
            document.getElementById("modalQuoteAuthor").textContent;
          shareQuote(`${quoteText} ${quoteAuthor}`);
        });

        // Add quote form
        addQuoteForm.addEventListener("submit", (e) => {
          e.preventDefault();
          addNewQuote();
        });

        // Explore and random buttons
        exploreBtn.addEventListener("click", () => {
          document
            .getElementById("quotesSection")
            .scrollIntoView({ behavior: "smooth" });
        });

        randomQuoteBtn.addEventListener("click", () => {
          const randomQuote =
            currentQuotes[Math.floor(Math.random() * currentQuotes.length)];
          showQuoteDetail(randomQuote);
        });

        loadMoreBtn.addEventListener("click", async () => {
          loadMoreBtn.disabled = true;
          loadMoreBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';

          const newQuotes = await fetchQuotesFromAPI();
          if (newQuotes && newQuotes.length > 0) {
            quotes.push(...newQuotes);
            currentQuotes = [...quotes];
            saveQuotes(quotes);
            renderQuotes();
            showToast(`Added ${newQuotes.length} new quotes!`, "success");
          } else {
            showToast("Failed to load more quotes. Please try again.", "error");
          }

          loadMoreBtn.disabled = false;
          loadMoreBtn.innerHTML = "Load More Quotes";
        });

        // Favorites functionality
        favoritesBtn.addEventListener("click", () => {
          console.log("Favorites button clicked");
          console.log("Favorites modal element:", favoritesModal);
          renderFavorites();
          if (favoritesModal) {
            favoritesModal.classList.remove("hidden");
            favoritesModal.style.display = "block";
            console.log("Favorites modal should be visible");
          } else {
            console.error("Favorites modal not found!");
          }
        });

        closeFavoritesModal.addEventListener("click", () => {
          favoritesModal.classList.add("hidden");
          favoritesModal.style.display = "none";
        });

        clearAllFavorites.addEventListener("click", () => {
          if (confirm("Are you sure you want to clear all favorites?")) {
            saveFavorites([]);
            renderFavorites();
            renderQuotes();
            showToast("All favorites cleared", "success");
          }
        });

        // Quote of the Day functionality
        refreshDailyQuote.addEventListener("click", async () => {
          refreshDailyQuote.disabled = true;
          refreshDailyQuote.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';

          localStorage.removeItem("dailydose-daily-quote");
          await loadQuoteOfTheDay();

          refreshDailyQuote.disabled = false;
          refreshDailyQuote.innerHTML =
            '<i class="fas fa-sync-alt mr-2"></i>New Daily Quote';
        });

        addToFavorites.addEventListener("click", () => {
          if (currentDailyQuote) {
            toggleFavorite(currentDailyQuote.id);
          }
        });

        // Close modals on backdrop click
        [addQuoteModal, quoteDetailModal, favoritesModal].forEach((modal) => {
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              modal.classList.add("hidden");
              if (modal === favoritesModal) {
                modal.style.display = "none";
              }
            }
          });
        });
      }

      // Filter quotes
      function filterQuotes(searchTerm, category) {
        currentQuotes = quotes.filter((quote) => {
          const matchesSearch =
            quote.text.toLowerCase().includes(searchTerm) ||
            quote.author.toLowerCase().includes(searchTerm);
          const matchesCategory =
            category === "all" || quote.category === category;
          return matchesSearch && matchesCategory;
        });
        renderQuotes();
      }

      // Add new quote
      function addNewQuote() {
        const text = document.getElementById("quoteText").value.trim();
        const author = document.getElementById("quoteAuthor").value.trim();
        const category = document.getElementById("quoteCategory").value;

        if (!text || !author) {
          showToast("Please fill in all fields", "error");
          return;
        }

        const newQuote = {
          id: Date.now(),
          text,
          author,
          category,
        };

        quotes.unshift(newQuote);
        currentQuotes = [...quotes];
        saveQuotes(quotes); // Save to localStorage
        renderQuotes();

        addQuoteModal.classList.add("hidden");
        addQuoteForm.reset();
        showToast("Quote added successfully!", "success");
      }

      // Show quote detail
      function showQuoteDetail(quote) {
        document.getElementById("modalQuoteText").textContent = quote.text;
        document.getElementById(
          "modalQuoteAuthor"
        ).textContent = `â€” ${quote.author}`;
        quoteDetailModal.classList.remove("hidden");
      }

      // Copy quote
      function copyQuote(text) {
        navigator.clipboard.writeText(text).then(() => {
          showToast("Quote copied to clipboard!", "success");
        });
      }

      // Share quote
      function shareQuote(text) {
        if (navigator.share) {
          navigator.share({
            title: "DailyDose Quote",
            text: text,
          });
        } else {
          copyQuote(text);
        }
      }

      // Delete quote
      function deleteQuote(id) {
        if (confirm("Are you sure you want to delete this quote?")) {
          const index = quotes.findIndex((q) => q.id === id);
          if (index > -1) {
            quotes.splice(index, 1);
            currentQuotes = [...quotes];
            saveQuotes(quotes); // Save to localStorage
            renderQuotes();
            showToast("Quote deleted successfully!", "success");
          }
        }
      }

      // Show toast notification
      function showToast(message, type = "success") {
        const toast = document.getElementById("successToast");
        const toastMessage = document.getElementById("toastMessage");

        toastMessage.textContent = message;

        if (type === "error") {
          toast.className =
            "fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50";
        } else {
          toast.className =
            "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50";
        }

        toast.classList.remove("translate-x-full");

        setTimeout(() => {
          toast.classList.add("translate-x-full");
        }, 3000);
      }

      // Dark mode functionality
      function initDarkMode() {
        const darkMode = localStorage.getItem("darkMode") === "true";
        const icon = document.querySelector("#darkModeToggle i");

        if (darkMode) {
          document.body.classList.add("dark");
          icon.className = "fas fa-sun text-yellow-500";
        } else {
          document.body.classList.remove("dark");
          icon.className = "fas fa-moon text-gray-600";
        }
      }

      // Dark mode toggle
      document
        .getElementById("darkModeToggle")
        .addEventListener("click", () => {
          const isDark = document.body.classList.toggle("dark");
          const icon = document.querySelector("#darkModeToggle i");

          if (isDark) {
            icon.className = "fas fa-sun text-yellow-500";
            localStorage.setItem("darkMode", "true");
          } else {
            icon.className = "fas fa-moon text-gray-600";
            localStorage.setItem("darkMode", "false");
          }
        });

      // Initialize the app
      init();
      initDarkMode();
    </script>
  </body>
</html>
